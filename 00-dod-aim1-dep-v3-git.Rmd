---
title: "dod-aim1-dep"
author: "Kaarina Kowalec"
date: "`r Sys.Date()`"
  output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    toc: true
---

# Background
These analyses are related to investigating the association between polygenicity
of depression and comorbid depression in multiple sclerosis. This file covers
the analyses related to the Canadian/USA datasets

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```


# 1. Load libraries
```{r}
library(tidyverse) # for data wrangling
library(data.table) # for text files
library(haven) # for SAS files
library(readxl) # for excel files
library(metafor) # for meta-analyses
set.seed(1234)
```

# 2. Load data
```{r}
load("/02_can_usa_processed_perindi_dep_29Nov2022.rdat")
# 1 at end of df name indicates these are those EUR ancestry outliers 3sd

can1 <- can1 %>%
  mutate(aim1a_mdd_phq9_above15=case_when(demo_disease == 1 & phq_above15 == 1 ~ 1,  # MS and PHQ9 >15
                        demo_disease==1 & phq_above15 == 0 ~ 0, # MS and no PHQ-9 15
                        TRUE~NA_real_),
         aim1b_mdd_phq9_above15=case_when(demo_disease == 1 & phq_above15 == 1 ~ 1,  # MS and PHQ9 >15
                        demo_disease==4 & phq_above15 == 1 ~ 0, # mdd no MS
                        TRUE~NA_real_),
         aim1c_mdd_phq9_above10=case_when(demo_disease == 1 & phq_above10 == 1 ~ 1,  # MS and PHQ9 >10
                        demo_disease==6 & phq_above10 == 0 ~ 0, # hc, no phq9 10
                        TRUE~NA_real_))

can1 <- can1 %>%
  mutate(diseasegroup = case_when(demo_disease == 1 & demo_depression==1 ~ 1,  # MS and self rep MDD
                        demo_disease == 1 & demo_depression == 0 ~ 2, # MS no self rep MDD
                        demo_disease == 4 & demo_depression == 1 ~ 3, # mdd no MS
                        demo_disease==6 ~ 0, #HC
                        TRUE~NA_real_))

can1 <- can1 %>%
  mutate(mdd = ifelse(demo_disease == 4, 1, 0),
         ms = ifelse(demo_disease == 1, 1, 0))
         
can1$mdd<-as.integer(can1$mdd)
can1$ms<-as.integer(can1$ms)

can1 <- can1 %>%
  mutate(interact_mdd_bmiPRS.s6 = mdd*z_bmi.s6,
         interact_mdd_mddPRS.s8 = mdd*z_mdd.s8,
         interact_MS_bmiPRS.s6 = ms*z_bmi.s6,
         interact_MS_mddPRS.s8 = ms*z_mdd.s8
         )
can1$demo_disease <- as.factor(can1$demo_disease)
can1$demo_disease <- relevel(can1$demo_disease, ref="6")


```

# 3. Filter to study cohort
```{r eval = FALSE,echo=FALSE}
# no need to run as already done in the file in "load" from beginning


can1 <- can1 %>%
  mutate(table1filter=case_when(demo_disease==1 & demo_depression==1 ~ "MS-Dep", #selfreport dep
                                demo_disease==1 & demo_depression==0 ~ "MS-NoDep", #no selfreport dep
                                demo_disease==4 & demo_depression==1 ~ "Dep",
                                demo_disease==6 ~ "healthy",
                                TRUE ~ NA_character_)) 

```


# 4. Table 1 - characteristics - Canada
```{r}

table(can1$table1filter)

nrow(can1)

# continuous
can1 %>%
  group_by(table1filter) %>%
  summarise(age=mean(age,na.rm=T),
            sd_age=sd(age,na.rm=T),
            education_yrs=mean(demo_yrs_educ.x),
            sd_educ_yrs=sd(demo_yrs_educ.x,na.rm=T),
            phq9_score=mean(baseline_phq_total_score,na.rm=T),
            sd_phq9=sd(baseline_phq_total_score,na.rm=T))

can1 %>%
  group_by(table1filter) %>%
  summarise(bmiprs=mean(z_bmi.s8),
            bmiprs_sd=sd(z_bmi.s8),
            mddprs=mean(z_mdd.s1),
            mddprs_sd=sd(z_mdd.s1),
            bmi_mean=mean(BMI,na.rm=T),
            bmi_sd=sd(BMI,na.rm=T)
            )


# categorical

can1 %>%
  count(demo_gender,table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)
   
can1 %>%
  count(demo_educ_cat, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  count(demo_income_cat, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  count(demo_smoker, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  count(scid_ever_dep, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  count(demo_depression, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)
            
can1 %>%
  count(phq_above10, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)
            
can1 %>%
  count(phq_above15, table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  count(bmi_cat2,table1filter) %>%
  group_by(table1filter) %>%
  mutate(percent = n / sum(n) * 100)

#BMI_Cat2 = 0=healthy, 1=overwt, 2=obese


# sex strat numbers


can1 %>%
  filter(table1filter=="MS") %>%
  count(scid_ever_dep, demo_gender) %>%
  group_by(demo_gender) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  filter(table1filter=="MS") %>%
  count(demo_depression, demo_gender) %>%
  group_by(demo_gender) %>%
  mutate(percent = n / sum(n) * 100)
            
can1 %>%
  filter(table1filter=="MS") %>%
  count(phq_above10, demo_gender) %>%
  group_by(demo_gender) %>%
  mutate(percent = n / sum(n) * 100)

can1 %>%
  filter(table1filter=="MS") %>%
  count(phq_above15, demo_gender) %>%
  group_by(demo_gender) %>%
  mutate(percent = n / sum(n) * 100)

# correlation between BMI and BMI PRS in CAD

# MS DEP-lifetimeMDD
ms_dep <- can1 %>%
  filter(aim1a_mdd_icd_cidi_scid==1) %>%
  select(BMI,z_bmi.s8)
cor.test(ms_dep$BMI, ms_dep$z_bmi.s8)

# MS DEP-self reported
ms_dep <- can1 %>%
  filter(aim1a_mdd_selfreported==1) %>%
  select(BMI,z_bmi.s8)
cor.test(ms_dep$BMI, ms_dep$z_bmi.s8)

# MS noDEP
ms_nodep <- can1 %>%
  filter(aim1a_mdd_selfreported==0) %>%
  select(BMI,z_bmi.s8)
cor.test(ms_nodep$BMI, ms_nodep$z_bmi.s8)

# DEP, no immune
dep <- can1 %>%
  filter(aim1b_mdd_selfreported==0) %>%
  select(BMI,z_bmi.s8)
cor.test(dep$BMI, dep$z_bmi.s8)

# Healthy
hc <- can1 %>%
  filter(aim1c_mdd_selfreported==0) %>%
  select(BMI,z_bmi.s8)
cor.test(hc$BMI, hc$z_bmi.s8)
```

# 5. Table 1 - characteristics - USA
```{r}

nrow(usa1)


table(usa1$status_dp)

# continuous
usa1 %>%
  group_by(status_dp) %>%
  summarise(age=mean(age,na.rm=T),
            sd_age=sd(age,na.rm=T),
            bmiprs=mean(z_bmi.s3),
            bmiprs_sd=sd(z_bmi.s3),
            mddprs=mean(z_mdd.s8), #value is zero, Sd=1 bc its been standardized
            mddprs_sd=sd(z_mdd.s8),
            bmi_mean=mean(BMI),
            bmi_sd=sd(BMI)
            )

# categorical
usa1 %>%
  count(gender,status_dp)%>%
  group_by(status_dp) %>%
  mutate(percent = n / sum(n) * 100)
   
#ed_b = 1 (HS or less), 0 (college or some)

usa1 %>%
  count(ed_b,status_dp) %>%
  group_by(status_dp) %>%
  mutate(percent = n / sum(n) * 100)

usa1 %>%
  count(sm_hx,status_dp) %>%
    group_by(status_dp) %>%
mutate(percent = n / sum(n) * 100)

usa1 %>%
  count(status_dp) %>%
  mutate(percent = n / sum(n) * 100)

usa1 %>%
  count(gender,status_dp) %>%
  group_by(status_dp) %>%
  mutate(percent = n / sum(n) * 100)

usa1 %>%
  count(bmi_cat2,status_dp) %>%
    group_by(status_dp) %>%
mutate(percent = n / sum(n) * 100)

#BMI_Cat2 = 0=healthy, 1=overwt, 2=obese


# BMI and BMI PRS correlation

# MS DEP-self reported
ms_dep <- usa1 %>%
  filter(status_dp==1) %>%
  select(BMI,z_bmi.s3)
cor.test(ms_dep$BMI, ms_dep$z_bmi.s3)

# MS noDEP
ms_nodep <- usa1 %>%
   filter(status_dp==0) %>%
  select(BMI,z_bmi.s3)
cor.test(ms_nodep$BMI, ms_nodep$z_bmi.s3)

```

# 6. Aim 1a
```{r}
######### CANADA

# Aim 1a - def1
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


############ USA

# Aim 1a- def2

test <- glm(as.factor(status_dp) ~ age + z_mdd.s8 + gender +
              z_bmi.s3 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=usa1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

```
# 7. Aim 1b
```{r}


#################
#AIM 1b
#################


# Aim 1b
test <- glm(as.factor(aim1b_mdd_icd_cidi_scid) ~ age + demo_gender +z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1b- def2

test <- glm(as.factor(aim1b_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


# Aim 1b - def4

test <- glm(as.factor(aim1b_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


```

# 8. Aim 1c
```{r}



#################
#AIM 1c
#################

# Aim 1c
test <- glm(as.factor(aim1c_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s8 +
              z_bmi.s4 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


# Aim 1c- def2

test <- glm(as.factor(aim1c_mdd_selfreported) ~ age + demo_gender + z_mdd.s8 +
              z_bmi.s4 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


# Aim 1c- def3

test <- glm(as.factor(aim1c_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s8 +
              z_bmi.s4 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

```

# 9. Aim 1a-Gender stratified and meta-analyses
```{r}
# CANADA

# FEMALE
# Aim 1a - def1

test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def5

test <- lm(baseline_phq_total_score ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=(demo_disease1==1 & demo_gender==1))
summary(test)

# ###### MALE
# Aim 1a - def1

test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=demo_gender==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def5

test <- lm(baseline_phq_total_score ~ age + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=(demo_disease1==1 & demo_gender==0))
summary(test)


# USA
# FEMALE

# Aim 1a- def2

test <- glm(as.factor(status_dp) ~ age + z_mdd.s8 +
                   z_bmi.s3 + PC1 + PC2 + PC3 + PC4 + PC5, data=usa1,
            subset=gender=="F", family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# MALE
# Aim 1a- def2

test <- glm(as.factor(status_dp) ~ age + z_mdd.s8 +
              z_bmi.s3 + PC1 + PC2 + PC3 + PC4 + PC5, data=usa1,
            subset=gender=="M", family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


```

```{r, eval=FALSE}
# meta analyses for only Aim 1a

gender <- readxl::read_xlsx("~/00-allcohorts-dep-aim1-12Apr2022-v2-forCassy.xlsx",sheet="gender-strat")

# FEMALE

aim1a.2 <- gender %>% filter(aim=="1a") %>% filter(definition == "selfreported" & gender=="female") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=se, method="FE", data = aim1a.2)
summary(res.fe)


aim1a.2 <- gender %>% filter(aim=="1a") %>% filter(definition == "selfreported" & gender=="female") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=se, method="FE", data = aim1a.2)
summary(res.fe)

# MALE

aim1a.2 <- gender %>% filter(aim=="1a") %>% filter(definition == "selfreported" & gender=="male") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=se, method="FE", data = aim1a.2)
summary(res.fe)


aim1a.2 <- gender %>% filter(aim=="1a") %>% filter(definition == "selfreported" & gender=="male") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=se, method="FE", data = aim1a.2)
summary(res.fe)



```


# 10. PHQ-9 linear model and gender stratified
```{r,include=FALSE,eval=FALSE}

# model with PCs only 
# NULL

test <- lm(baseline_phq_total_score ~ PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)
# 0.02479

# MDD
# S1
test <- lm(baseline_phq_total_score ~ z_mdd.s1 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S2
test <- lm(baseline_phq_total_score ~ z_mdd.s2 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S3
test <- lm(baseline_phq_total_score ~ z_mdd.s3 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S4
test <- lm(baseline_phq_total_score ~ z_mdd.s4 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S5
test <- lm(baseline_phq_total_score ~ z_mdd.s5 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S6
test <- lm(baseline_phq_total_score ~ z_mdd.s6 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S7
test <- lm(baseline_phq_total_score ~ z_mdd.s7 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S8
test <- lm(baseline_phq_total_score ~ z_mdd.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)


################################################################################
####### Selection of BMI PRS pT ######### ###### ###### ###### ###### ###### ###
################################################################################

# BMI
# S1
test <- lm(baseline_phq_total_score ~ z_bmi.s1 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S2
test <- lm(baseline_phq_total_score ~ z_bmi.s2 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S3
test <- lm(baseline_phq_total_score ~ z_bmi.s3 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S4
test <- lm(baseline_phq_total_score ~ z_bmi.s4 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S5
test <- lm(baseline_phq_total_score ~ z_bmi.s5 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S6
test <- lm(baseline_phq_total_score ~ z_bmi.s6 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S7
test <- lm(baseline_phq_total_score ~ z_bmi.s7 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# S8
test <- lm(baseline_phq_total_score ~ z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)


```

```{r}

###### WITH INTERACTION TERMS ##############
# need two new variables for disease indicator - see above in '2.load data'
test <- lm(baseline_phq_total_score ~ age + demo_gender + z_mdd.s8 + z_bmi.s6 + demo_disease +
             interact_mdd_bmiPRS.s6 + interact_mdd_mddPRS.s8 + interact_MS_bmiPRS.s6 + interact_MS_mddPRS.s8 +
             PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# BMI CATEGORY: normal
test <- lm(baseline_phq_total_score ~ age + demo_gender + z_mdd.s8 + z_bmi.s6 + demo_disease +
            interact_mdd_mddPRS.s8 + interact_MS_mddPRS.s8 + PC1_3sd + PC2_3sd +
             PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=bmi_cat1==0)
summary(test)

# BMI CATEGORY: overweight
test <- lm(baseline_phq_total_score ~ age + demo_gender + demo_disease + z_mdd.s8 + z_bmi.s6 +
            interact_mdd_mddPRS.s8 + interact_MS_mddPRS.s8 + PC1_3sd + PC2_3sd +
             PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=bmi_cat1==1)
summary(test)


###### NO INTERACTION  ##############

test <- lm(baseline_phq_total_score ~ age + demo_gender + z_mdd.s8 + z_bmi.s6 + demo_disease +
             PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

# BMI CATEGORY: normal
test <- lm(baseline_phq_total_score ~ age + demo_gender + z_mdd.s8 + z_bmi.s6 + demo_disease +
             PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=bmi_cat1==0)
summary(test)

# BMI CATEGORY: overweight
test <- lm(baseline_phq_total_score ~ age + demo_gender + demo_disease + z_mdd.s8 + z_bmi.s6 +
            PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=bmi_cat1==1)
summary(test)



###### GENDER STRAT ##############

# FEMALE
test <- lm(baseline_phq_total_score ~ age + z_mdd.s8 + z_bmi.s6 + demo_disease +
             PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=demo_gender==1)
summary(test)

# MALE
test <- lm(baseline_phq_total_score ~ age + demo_disease + z_mdd.s8 + z_bmi.s6 +
            PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,subset=demo_gender==0)
summary(test)



```

# 11. BMI Stratified models-Aim1a
```{r}

# bmi_cat1 = 0 (healthy or under), 1 (overweight or above)

######## CANADA
# healthy or underwt
# Aim 1a - def1
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, 
            data=can1, subset=bmi_cat1==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=bmi_cat1==0,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=bmi_cat1==0,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

######## CANADA
# obese or above
# Aim 1a - def1
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, 
            data=can1, subset=bmi_cat1==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=bmi_cat1==1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset=bmi_cat1==1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))



############ USA

# Aim 1a- def2 - healthy BMI

test <- glm(as.factor(status_dp) ~ age + z_mdd.s8 + gender +
              z_bmi.s3 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, 
                subset=bmi_cat1==0, data=usa1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


############ USA

# Aim 1a- def2 - obese BMI

test <- glm(as.factor(status_dp) ~ age + z_mdd.s8 + gender + z_bmi.s3 + 
              PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=usa1, 
                subset=bmi_cat1==1,family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

```
# 12. BMI Stratified models-Aim1b
```{r}

#################
#AIM 1b
#################


# Aim 1b
test <- glm(as.factor(aim1b_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset = bmi_cat1 == 0,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1b- def2

test <- glm(as.factor(aim1b_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
             subset = bmi_cat1 == 0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1b - def4

test <- glm(as.factor(aim1b_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
             subset = bmi_cat1 == 0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

#### OBESE

# Aim 1b
test <- glm(as.factor(aim1b_mdd_icd_cidi_scid) ~ age + demo_gender +z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            subset = bmi_cat1 == 1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1b- def2

test <- glm(as.factor(aim1b_mdd_selfreported) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8  + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
             subset = bmi_cat1 == 1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1b - def4

test <- glm(as.factor(aim1b_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1 +
              z_bmi.s8 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
             subset = bmi_cat1 == 1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

```

# 13. Meta-analyses-Aim 1a
```{r,eval=FALSE}
# metafor-meta analysis of dod aim 1 dep
# 04/2022 by kk

full <- readxl::read_xlsx("~/00-allcohorts-dep-aim1-12Apr2022-v2.xlsx")

##################
##### MDD ########
##################

aim1a.1 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.1)
summary(res.fe)

aim1a.2 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.2)
summary(res.fe)

aim1a.4 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9_above10") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.4)
summary(res.fe)

aim1a.5 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.5)
summary(res.fe)


##################
###### BMI #######
##################

aim1a.1 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.1)
summary(res.fe)

aim1a.2 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.2)
summary(res.fe)

aim1a.4 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9_above10") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.4)
summary(res.fe)

aim1a.5 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.5)
summary(res.fe)
```

# 14. Meta-analyses-Aim 1b
```{r,eval=FALSE}

##################
##### MDD ########
##################

aim1b.1 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.1)
summary(res.fe)

aim1b.2 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.2)
summary(res.fe)

aim1b.4 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_phq9_above10") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.4)
summary(res.fe)

aim1b.5 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_phq9") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.5)
summary(res.fe)


##################
###### BMI #######
##################

aim1b.1 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.1)
summary(res.fe)

aim1b.2 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.2)
summary(res.fe)


aim1b.4 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_phq9_above10") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.4)
summary(res.fe)

aim1b.5 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_phq9") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.5)
summary(res.fe)
```

# 15. Meta-analyses-Aim 1c
```{r,eval=FALSE}

##################
##### MDD ########
##################

aim1c.1 <- full %>% filter(aim=="1c") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1c.1)
summary(res.fe)

aim1c.2 <- full %>% filter(aim=="1c") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="mdd")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1c.2)
summary(res.fe)

##################
###### BMI #######
##################

aim1c.1 <- full %>% filter(aim=="1c") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1c.1)
summary(res.fe)

aim1c.2 <- full %>% filter(aim=="1c") %>% filter(definition == "mdd_selfreported") %>% filter(PRS=="bmi")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1c.2)
summary(res.fe)

```
# 16. Meta-analyses-All Aim1-PHQ-9

```{r}
# metafor-meta analysis of dod aim 1 dep
# for phq-9 only

phq9 <- readxl::read_xlsx("~/00-allcohorts-dep-aim1-25May2022.xlsx",sheet="phq9")

#Fixed-effect inverse-variance weighted meta-analysis

##################
##### ALL ########
##################

phq9.all <- phq9 %>% filter(strat=="full")

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="mdd_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="bmi_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_mdd_icd")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_ms")
summary(res.fe)

############################
##### BMI Stratified #######
############################

phq9.all <- phq9 %>% filter(strat=="healthy")

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="mdd_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="bmi_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_mdd_icd")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_ms")
summary(res.fe)


############################
##### BMI Stratified -o/w ##
############################

phq9.all <- phq9 %>% filter(strat=="overweight")

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="mdd_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="bmi_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_mdd_icd")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_ms")
summary(res.fe)

############################
##### Sex Stratified #######
############################

phq9.all <- phq9 %>% filter(strat=="males")

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="mdd_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="bmi_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_mdd_icd")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_ms")
summary(res.fe)


############################
##### Sex Stratified #######
############################

phq9.all <- phq9 %>% filter(strat=="females")

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="mdd_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="bmi_prs")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_mdd_icd")
summary(res.fe)

res.fe <- rma(yi=estimate, sei=std.error, method="FE", data = phq9.all, subset=factor=="demo_disease_ms")
summary(res.fe)
```

# 17. Plots
```{r,eval=FALSE}
plot <- readxl::read_xlsx("~/00-allcohorts-dep-aim1-25May2022.xlsx",sheet="v2") %>% as_tibble() 

# plot OR and 95%CI

plot$aim <- factor(plot$aim, levels=c("A: Multiple sclerosis-depression vs. multiple sclerosis-no depression","B: Multiple sclerosis-depression vs. depression-no immune disease","Multiple sclerosis-depression vs. healthy"))
plot$Sample <- factor(plot$Sample, levels = c("Canada","UK","USA","Meta-analysis"))
plot$definition <- factor(plot$definition, levels = c("Lifetime MDD","Self-reported depression","PHQ-9 ≥ 10"))
aim1 <- plot %>% filter(aim!="Multiple sclerosis-depression vs. healthy")

fpA <- ggplot(data=aim1) +
  geom_pointrange(aes(x=definition, y=estimate, ymin=lower, ymax=upper, 
                      color=Sample), size=.75, position=position_dodge(width=.75)) + 
  geom_hline(yintercept=1,lty=1,size=.5) +  
  facet_grid(. ~ aim, scales = "free")  + 
  xlab("Depression Definition") + 
  ylab("Odds Ratio (95% CI)") +
  scale_y_continuous(breaks = seq(0.75,2, by=0.5), limits = c(0.75,2)) +
  theme(strip.text.x = element_text(size=12),
        axis.title.x = element_text(size=12),
        axis.title.y = element_text(size=12),
        axis.text.y = element_text(size=12),
        axis.text.x = element_text(size=12,angle=45,vjust=0.5),
        axis.ticks = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black",size=.25),
        legend.position = "bottom",
        legend.text = element_text(size=12))

ggsave(file="~/00-allcohorts-dep-aim1-9June2022.png",fpA,width = 15,heigh=7) # change date in file name


```

```{r, Venn Diagram}

library(ggvenn)

###### MS CANADA
can1_venn_ms <- can1 %>%
  filter(demo_disease==1) %>%
  mutate(ms_nodep = case_when( (aim1a_mdd_icd_cidi_scid == 0 & aim1a_mdd_selfreported ==0 & aim1a_mdd_phq9_above10==0|is.na(aim1a_mdd_phq9_above10)) ~ 0, TRUE~1)) %>%
  filter(ms_nodep==1) %>%
  select(demo_studyid,aim1a_mdd_icd_cidi_scid,aim1a_mdd_selfreported,aim1a_mdd_phq9_above10) %>%
  mutate(aim1a_mdd_icd_cidi_scid=ifelse(aim1a_mdd_icd_cidi_scid==1,TRUE,FALSE),
         aim1a_mdd_selfreported=ifelse(aim1a_mdd_selfreported==1,TRUE,FALSE),
         aim1a_mdd_phq9_above10=ifelse(is.na(aim1a_mdd_phq9_above10),FALSE,aim1a_mdd_phq9_above10),
         aim1a_mdd_phq9_above10=ifelse(aim1a_mdd_phq9_above10==1,TRUE,FALSE)
         ) %>%
  rename(`Lifetime MDD`=aim1a_mdd_icd_cidi_scid,
         `Self-reported depression`=aim1a_mdd_selfreported,
         `PHQ-9 ≥ 10`=aim1a_mdd_phq9_above10)

x <- ggplot(can1_venn_ms) +
  geom_venn(aes(A = `Lifetime MDD`, B = `Self-reported depression`, C = `PHQ-9 ≥ 10`)) +
  coord_fixed() +
  theme_void() 

######### DEP CANADA

can1_venn_dep <- can1 %>%
  filter(demo_disease==4) %>%
  select(demo_studyid,aim1b_mdd_icd_cidi_scid,aim1b_mdd_selfreported,aim1b_mdd_phq9_above10) %>%
  mutate(aim1b_mdd_icd_cidi_scid=ifelse(aim1b_mdd_icd_cidi_scid==0,TRUE,FALSE),
         aim1b_mdd_selfreported=ifelse(aim1b_mdd_selfreported==0,TRUE,FALSE),
         aim1b_mdd_phq9_above10=ifelse(aim1b_mdd_phq9_above10==0,TRUE,FALSE),
          aim1b_mdd_phq9_above10=ifelse(is.na(aim1b_mdd_phq9_above10),FALSE,aim1b_mdd_phq9_above10)
         ) %>%
  rename(`Lifetime MDD`=aim1b_mdd_icd_cidi_scid,
         `Self-reported depression`=aim1b_mdd_selfreported,
         `PHQ-9 ≥ 10`=aim1b_mdd_phq9_above10)

x1 <- ggplot(can1_venn_dep) +
  geom_venn(aes(A = `Lifetime MDD`, B = `Self-reported depression`, C = `PHQ-9 ≥ 10`)) +
  coord_fixed() +
  theme_void() 


library(cowplot)
fp12 <- plot_grid(x,x1, labels = c("A: Canada-Multiple sclerosis", "B: Canada-Depression, no immune disease"), nrow = 1, align = "h", axis='l')

fp12


save_plot("~/00-can-venn-31May22.png", fp12,
         nrow = 2, ncol = 2, # and 2 rows
# each individual subplot should have an aspect ratio of 1.3
base_aspect_ratio = 1.8)


```
# 18. Additional analyses
```{r}

####################
# Is baseline BMI associated with depression? basic stats
# test for sig in BMI
sub <- can1 %>% filter(table1filter=="Dep" | table1filter=="healthy")
wilcox.test(BMI~table1filter, data=sub) #p=1.1e-6

sub <- can1 %>% filter(table1filter=="MS-Dep" | table1filter=="healthy")
wilcox.test(BMI~table1filter, data=sub) #p=1.0e-4

sub <- can1 %>% filter(table1filter=="MS-Dep" | table1filter=="MS-NoDep")
wilcox.test(BMI~table1filter, data=sub) #p=NS

sub <- can1 %>% filter(table1filter=="MS-Dep" | table1filter=="Dep")
wilcox.test(BMI~table1filter, data=sub) #p=NS

wilcox.test(BMI~status_dp, data=usa1) #p=NS

####################
# Is baseline BMI associated with depression? log reg modelling
# Aim 1a - def1 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def2 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def3 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# USA
test <- glm(as.factor(status_dp) ~ age + BMI + gender, data=usa1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# AIM 1b
# def1 _ baseline BMI vs depression
test <- glm(as.factor(aim1b_mdd_icd_cidi_scid) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def2 _ baseline BMI vs depression
test <- glm(as.factor(aim1b_mdd_selfreported) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def3 _ baseline BMI vs depression
test <- glm(as.factor(aim1b_mdd_phq9_above10) ~ age + demo_gender + BMI, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

### SEX STRATIFIED MODELS- FEMALES
# Is baseline BMI associated with depression? log reg modelling
# Aim 1a - def1 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + BMI, data=can1,
            subset=demo_gender==1,family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def2 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + BMI, data=can1,
             subset=demo_gender==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def3 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age +  BMI, data=can1,
             subset=demo_gender==1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def1 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + BMI, data=can1,
            subset=demo_gender==0,family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def2 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + BMI, data=can1,
             subset=demo_gender==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def3 _ baseline BMI vs depression
test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age +  BMI, data=can1,
             subset=demo_gender==0, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# USA
test <- glm(as.factor(status_dp) ~ age + BMI, subset=gender=="F", data=usa1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))
# USA
test <- glm(as.factor(status_dp) ~ age + BMI, subset=gender=="M", data=usa1, family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

##### META ANALYSIS W UKBB
full <- readxl::read_xlsx("~/00-allcohorts-dep-aim1-12Apr2022-v2.xlsx", sheet="bmi_noPRS")

##################
##### META of baseline BMI (not PRS) ########
##################
aim1a.1 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(stratify=="no")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE",data=aim1a.1)
summary(res.fe)

aim1a.2 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_selfreported") %>% filter(stratify=="no")
#random-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="REML", data = aim1a.2)
summary(res.fe)

aim1a.3 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9_above10") %>% filter(stratify=="no")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.3)
summary(res.fe)

#STRATIFY
##################
aim1a.1 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(stratify=="female")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE",data=aim1a.1)
summary(res.fe)

aim1a.2 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_selfreported") %>% filter(stratify=="female")
#random-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.2)
summary(res.fe)

aim1a.3 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9_above10") %>% filter(stratify=="female")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.3)
summary(res.fe)


##################
aim1a.1 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(stratify=="male")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE",data=aim1a.1)
summary(res.fe)

aim1a.2 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_selfreported") %>% filter(stratify=="male")
#random-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1a.2)
summary(res.fe)

aim1a.3 <- full %>% filter(aim=="1a") %>% filter(definition == "mdd_phq9_above10") %>% filter(stratify=="male")
res.fe <- rma(yi=estimate, sei=SE, method="REML", data = aim1a.3)
summary(res.fe)



# next aim
aim1b.1 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_icd_cidi_scid") %>% filter(stratify=="no")
res.fe <- rma(yi=estimate, sei=SE, method="REML",data=aim1b.1)
summary(res.fe)

aim1b.2 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_selfreported") %>% filter(stratify=="no")
#random-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.2)
summary(res.fe)

aim1b.3 <- full %>% filter(aim=="1b") %>% filter(definition == "mdd_phq9_above10") %>% filter(stratify=="no")
#Fixed-effect inverse-variance weighted meta-analysis
res.fe <- rma(yi=estimate, sei=SE, method="FE", data = aim1b.3)
summary(res.fe)


# PHQ-9 linear model assumptions
plot(can1$baseline_phq_total_score, can1$z_mdd.s8)
plot(can1$baseline_phq_total_score, can1$z_bmi.s6)

test <- lm(baseline_phq_total_score ~ age + demo_gender + z_mdd.s8 + z_bmi.s6 + demo_disease +
             PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1)
summary(test)

hist(test$residuals) #residuals normally distributed
qqnorm(test$residuals)
abline(qqline(test$residuals))
vif(test)
#no multicollinearity, residuals normally distributed


# add in MDD PRS info score =0.6 for neurology manuscript comments
mdd <- fread("~/PRS_mdd2019/mdd2019.S1-8.profile") %>%
  mutate(z_mdd.s1 = scale(S1, center = TRUE, scale = TRUE),
         z_mdd.s2 = scale(S2, center = TRUE, scale = TRUE),
         z_mdd.s3 = scale(S3, center = TRUE, scale = TRUE),
         z_mdd.s4 = scale(S4, center = TRUE, scale = TRUE),
         z_mdd.s5 = scale(S5, center = TRUE, scale = TRUE),
         z_mdd.s6 = scale(S6, center = TRUE, scale = TRUE),
         z_mdd.s7 = scale(S7, center = TRUE, scale = TRUE),
         z_mdd.s8 = scale(S8, center = TRUE, scale = TRUE)) %>%
  select(FID,IID,z_mdd.s1:z_mdd.s8)


mdd6 <- fread("~/PRS_mdd2019_info0.6/mdd2019.S1-8.profile") %>%
  mutate(z_mdd.s1_info6 = scale(S1, center = TRUE, scale = TRUE),
         z_mdd.s2_info6 = scale(S2, center = TRUE, scale = TRUE),
         z_mdd.s3_info6 = scale(S3, center = TRUE, scale = TRUE),
         z_mdd.s4_info6 = scale(S4, center = TRUE, scale = TRUE),
         z_mdd.s5_info6 = scale(S5, center = TRUE, scale = TRUE),
         z_mdd.s6_info6 = scale(S6, center = TRUE, scale = TRUE),
         z_mdd.s7_info6 = scale(S7, center = TRUE, scale = TRUE),
         z_mdd.s8_info6 = scale(S8, center = TRUE, scale = TRUE)) %>%
  select(FID,IID,z_mdd.s1_info6:z_mdd.s8_info6)

mdd <- left_join(mdd,mdd6)

mdd$z_mdd.s1 <- as.numeric(mdd$z_mdd.s1)
mdd$z_mdd.s2 <- as.numeric(mdd$z_mdd.s2)
mdd$z_mdd.s3 <- as.numeric(mdd$z_mdd.s3)
mdd$z_mdd.s4 <- as.numeric(mdd$z_mdd.s4)
mdd$z_mdd.s5 <- as.numeric(mdd$z_mdd.s5)
mdd$z_mdd.s6 <- as.numeric(mdd$z_mdd.s6)
mdd$z_mdd.s7 <- as.numeric(mdd$z_mdd.s7)
mdd$z_mdd.s8 <- as.numeric(mdd$z_mdd.s8)
mdd$z_mdd.s1_info6 <- as.numeric(mdd$z_mdd.s1_info6)
mdd$z_mdd.s2_info6 <- as.numeric(mdd$z_mdd.s2_info6)
mdd$z_mdd.s3_info6 <- as.numeric(mdd$z_mdd.s3_info6)
mdd$z_mdd.s4_info6 <- as.numeric(mdd$z_mdd.s4_info6)
mdd$z_mdd.s5_info6 <- as.numeric(mdd$z_mdd.s5_info6)
mdd$z_mdd.s6_info6 <- as.numeric(mdd$z_mdd.s6_info6)
mdd$z_mdd.s7_info6 <- as.numeric(mdd$z_mdd.s7_info6)
mdd$z_mdd.s8_info6 <- as.numeric(mdd$z_mdd.s8_info6)

library(psych)
corr.test(mdd$z_mdd.s1, mdd$z_mdd.s1_info6)
# r=0.99, p=1.0 between the two


# add in BMI PRS info score =0.6 for neurology manuscript comments
bmi <- fread("~/info9/bmi2018.S1-8.profile") %>%
  mutate(z_bmi.s1 = scale(S1, center = TRUE, scale = TRUE),
         z_bmi.s2 = scale(S2, center = TRUE, scale = TRUE),
         z_bmi.s3 = scale(S3, center = TRUE, scale = TRUE),
         z_bmi.s4 = scale(S4, center = TRUE, scale = TRUE),
         z_bmi.s5 = scale(S5, center = TRUE, scale = TRUE),
         z_bmi.s6 = scale(S6, center = TRUE, scale = TRUE),
         z_bmi.s7 = scale(S7, center = TRUE, scale = TRUE),
         z_bmi.s8 = scale(S8, center = TRUE, scale = TRUE)) %>%
  select(FID,IID,z_bmi.s1:z_bmi.s8)


bmi6 <- fread("~/bmi2018.S1-8.profile") %>%
  mutate(z_bmi.s1_info6 = scale(S1, center = TRUE, scale = TRUE),
         z_bmi.s2_info6 = scale(S2, center = TRUE, scale = TRUE),
         z_bmi.s3_info6 = scale(S3, center = TRUE, scale = TRUE),
         z_bmi.s4_info6 = scale(S4, center = TRUE, scale = TRUE),
         z_bmi.s5_info6 = scale(S5, center = TRUE, scale = TRUE),
         z_bmi.s6_info6 = scale(S6, center = TRUE, scale = TRUE),
         z_bmi.s7_info6 = scale(S7, center = TRUE, scale = TRUE),
         z_bmi.s8_info6 = scale(S8, center = TRUE, scale = TRUE)) %>%
  select(FID,IID,z_bmi.s1_info6:z_bmi.s8_info6)

bmi <- left_join(bmi,bmi6)

bmi$z_bmi.s1 <- as.numeric(bmi$z_bmi.s1)
bmi$z_bmi.s2 <- as.numeric(bmi$z_bmi.s2)
bmi$z_bmi.s3 <- as.numeric(bmi$z_bmi.s3)
bmi$z_bmi.s4 <- as.numeric(bmi$z_bmi.s4)
bmi$z_bmi.s5 <- as.numeric(bmi$z_bmi.s5)
bmi$z_bmi.s6 <- as.numeric(bmi$z_bmi.s6)
bmi$z_bmi.s7 <- as.numeric(bmi$z_bmi.s7)
bmi$z_bmi.s8 <- as.numeric(bmi$z_bmi.s8)
bmi$z_bmi.s1_info6 <- as.numeric(bmi$z_bmi.s1_info6)
bmi$z_bmi.s2_info6 <- as.numeric(bmi$z_bmi.s2_info6)
bmi$z_bmi.s3_info6 <- as.numeric(bmi$z_bmi.s3_info6)
bmi$z_bmi.s4_info6 <- as.numeric(bmi$z_bmi.s4_info6)
bmi$z_bmi.s5_info6 <- as.numeric(bmi$z_bmi.s5_info6)
bmi$z_bmi.s6_info6 <- as.numeric(bmi$z_bmi.s6_info6)
bmi$z_bmi.s7_info6 <- as.numeric(bmi$z_bmi.s7_info6)
bmi$z_bmi.s8_info6 <- as.numeric(bmi$z_bmi.s8_info6)

library(psych)
corr.test(bmi$z_bmi.s8, bmi$z_bmi.s8_info6)
# r=0.97, p=1.0 between the two
bmi <- bmi %>%
  mutate(demo_studyid = str_extract(IID,"[:digit:]{3,4}")) %>%
  select(-FID,-IID) %>%
  select(demo_studyid,z_bmi.s8_info6)


# now, try re-running the basic analyses for Canada Aim1a w updated PRS
mdd <- mdd %>%
  mutate(demo_studyid = str_extract(IID,"[:digit:]{3,4}")) %>%
  select(-FID,-IID) %>%
  select(demo_studyid,z_mdd.s1_info6)

mdd$demo_studyid <- as.numeric(mdd$demo_studyid)
bmi$demo_studyid <- as.numeric(bmi$demo_studyid)

can1 <- left_join(can1,mdd)
can1 <- left_join(can1,bmi)

######### CANADA

# Aim 1a - def1
test <- glm(as.factor(aim1a_mdd_icd_cidi_scid) ~ age + demo_gender + z_mdd.s1_info6 +
              z_bmi.s8_info6 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a- def2

test <- glm(as.factor(aim1a_mdd_selfreported) ~ age + demo_gender + z_mdd.s1_info6 +
              z_bmi.s8_info6 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))

# Aim 1a - def4

test <- glm(as.factor(aim1a_mdd_phq9_above10) ~ age + demo_gender + z_mdd.s1_info6 +
              z_bmi.s8_info6 + PC1_3sd + PC2_3sd + PC3_3sd + PC4_3sd + PC5_3sd, data=can1,
            family="binomial")
summary(test)
exp(cbind("Odds ratio" = coef(test), confint.default(test, level = 0.95)))


```

# Save
```{r, eval=FALSE}

#save(can,can1,usa1,usa,file="/02_can_usa_processed_perindi_dep_29Nov2022.rdat")

```
